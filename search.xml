<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>mysql备份策略(全量备份和增量备份)</title>
      <link href="/post/5a46718a.html"/>
      <url>/post/5a46718a.html</url>
      
        <content type="html"><![CDATA[<!-- build time:Wed Jan 30 2019 19:14:35 GMT+0800 (GMT+08:00) --><html><head></head><body><h2 id="技术点"><a href="#技术点" class="headerlink" title="技术点"></a>技术点</h2><ul><li>shell</li><li>mysql</li><li>crontab</li></ul><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul><li>服务器:centos7</li><li>数据库:mysql-5.7.19</li></ul><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ul><li><p>开启bin-log</p><figure class="highlight plain"><figcaption><span>/etc/my.cnf</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log-bin=master-bin</span><br></pre></td></tr></tbody></table></figure></li><li><p>重启mysql</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld restart</span><br></pre></td></tr></tbody></table></figure></li></ul><a id="more"></a><h2 id="全量备份脚本"><a href="#全量备份脚本" class="headerlink" title="全量备份脚本"></a>全量备份脚本</h2><figure class="highlight shell"><figcaption><span>/home/shell/mysql-full-bak.sh</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">source /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 常量</span></span><br><span class="line">Bakdir=/home/backup</span><br><span class="line">Logfile=/home/backup/bak.log</span><br><span class="line">Date=`date +%Y%m%d`</span><br><span class="line">Begin=`date +"%Y年%m月%d日 %H:%M:%S"`</span><br><span class="line"></span><br><span class="line">cd $Bakdir</span><br><span class="line"><span class="meta">#</span><span class="bash"> 全量导出文件</span></span><br><span class="line">Dumpfile=$Date.sql</span><br><span class="line"><span class="meta">#</span><span class="bash"> 压缩后文件</span></span><br><span class="line">GzDumpfile=$Date.sql.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 全量导出jczldb_dev_dy数据库</span></span><br><span class="line">mysqldump --single-transaction --master-data=2 --triggers --routines --databases jczldb_dev_dy --flush-logs --delete-master-logs --events  -uroot -p</span><br><span class="line">'123456' > $Dumpfile</span><br><span class="line"></span><br><span class="line">tar -zvcf $GzDumpfile $Dumpfile</span><br><span class="line"></span><br><span class="line">rm -rf $Dumpfile</span><br><span class="line"></span><br><span class="line">OldDate=`date -d '7 days ago' +%Y%m%d`</span><br><span class="line"></span><br><span class="line">OldBakFile=${OldDate}".tar.gz"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除七天前文件</span></span><br><span class="line">rm -rf $OldBakFile</span><br><span class="line"></span><br><span class="line">Last=`date +"%Y年%m月%d日 %H:%M:%S"`</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 写入备份日志</span></span><br><span class="line">echo 开始:$Begin 结束:$Last $GzDumpfile >> $Logfile</span><br><span class="line"></span><br><span class="line">cd $Bakdir/daily</span><br><span class="line"><span class="meta">#</span><span class="bash"> 全量备份后删除之前的增量备份文件</span></span><br><span class="line">rm -f *</span><br></pre></td></tr></tbody></table></figure><h2 id="增量备份脚本"><a href="#增量备份脚本" class="headerlink" title="增量备份脚本"></a>增量备份脚本</h2><figure class="highlight shell"><figcaption><span>/home/shell/mysql-daily-bak.sh</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">source /etc/profile</span><br><span class="line">BakDir=/home/backup/daily</span><br><span class="line">BinDir=/home/mysqldata</span><br><span class="line">LogFile=/home/backup/bak.log</span><br><span class="line">BinFile=/home/mysqldata/master-bin.index</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建新的bin</span></span><br><span class="line">mysqldump -uroot -p'123456' flush-logs</span><br><span class="line"><span class="meta">#</span><span class="bash"> bin文件数量</span></span><br><span class="line">Counter=`wc -l $BinFile | awk '{print $1}'`</span><br><span class="line"></span><br><span class="line">NextNum=0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 循环所有的bin文件</span></span><br><span class="line">for file in `cat $BinFile`</span><br><span class="line">do</span><br><span class="line">    base=`basename $file` # 取得bin文件名 如：master-bin.00001</span><br><span class="line">    # 留取新生成的bin不处理</span><br><span class="line">    NextNum=`expr $NextNum + 1`</span><br><span class="line">    if [ $NextNum -eq $Counter ]</span><br><span class="line">    then</span><br><span class="line">       # 最新的bin停止处理</span><br><span class="line">       echo $base 新生产bin文件不处理! >> $LogFile</span><br><span class="line">    else</span><br><span class="line">        # 判断已存在的bin不处理</span><br><span class="line">        dest=$BakDir/$base</span><br><span class="line">        if( test -e $dest )</span><br><span class="line">        then</span><br><span class="line">            echo $base 已存在! >> $LogFile</span><br><span class="line">        else</span><br><span class="line">            cp $BinDir/$base $BakDir</span><br><span class="line">            echo $base 拷贝中 >> $LogFile</span><br><span class="line">          fi</span><br><span class="line">     fi</span><br><span class="line"></span><br><span class="line">done</span><br></pre></td></tr></tbody></table></figure><h2 id="创建定时任务"><a href="#创建定时任务" class="headerlink" title="创建定时任务"></a>创建定时任务</h2><ul><li><p>编辑命令</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></tbody></table></figure></li><li><p>配置</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#每个星期日凌晨3:00执行完全备份脚本</span><br><span class="line">0 3 * * 0 /bin/bash -x /home/shell/mysql-full-bak.sh 2>&1</span><br><span class="line">#周一到周六凌晨3:00做增量备</span><br><span class="line">0 3 * * 1-6 /bin/bash -x /home/home/mysql-daily-bak.sh 2>&1</span><br></pre></td></tr></tbody></table></figure></li><li><p>赋予可执行权限</p></li></ul><figure class="highlight bash"><figcaption><span>/home/shell/</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod a+x mysql-full-bak.sh </span><br><span class="line">chmod a+x mysql-daily-bak.sh</span><br></pre></td></tr></tbody></table></figure><h2 id="将二进制bin转为sql"><a href="#将二进制bin转为sql" class="headerlink" title="将二进制bin转为sql"></a>将二进制bin转为sql</h2><figure class="highlight bash"><figcaption><span>/home/mysqldata/</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog --no-defaults master-bin.0000003 > ../dump.sql</span><br></pre></td></tr></tbody></table></figure><h2 id="还原备份-待完善"><a href="#还原备份-待完善" class="headerlink" title="还原备份(待完善)"></a>还原备份(待完善)</h2><hr><!-- rebuild by neat --></body></html>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>mysql修改存储地址</title>
      <link href="/post/a3505c8d.html"/>
      <url>/post/a3505c8d.html</url>
      
        <content type="html"><![CDATA[<!-- build time:Wed Jan 30 2019 19:14:35 GMT+0800 (GMT+08:00) --><html><head></head><body><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul><li>mysql版本:mysql-5.7.19-log</li><li>原存储目录: /var/lib/mysql</li><li>目标存储目录: /home/mysqldata</li></ul><h2 id="停止mysql服务"><a href="#停止mysql服务" class="headerlink" title="停止mysql服务"></a>停止mysql服务</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld stop</span><br></pre></td></tr></tbody></table></figure><h2 id="建立新的存储目录"><a href="#建立新的存储目录" class="headerlink" title="建立新的存储目录"></a>建立新的存储目录</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /home/mysqldata</span><br></pre></td></tr></tbody></table></figure><a id="more"></a><h2 id="复制数据库到新的存储目录"><a href="#复制数据库到新的存储目录" class="headerlink" title="复制数据库到新的存储目录"></a>复制数据库到新的存储目录</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -av /var/lib/mysql/* /home/mysqldata</span><br></pre></td></tr></tbody></table></figure><h2 id="修改目录权限"><a href="#修改目录权限" class="headerlink" title="修改目录权限"></a>修改目录权限</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 更改用户组/用户为mysql:mysql</span></span><br><span class="line">chown -vR mysql:mysql /home/mysqldata/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 更改访问权限为700</span></span><br><span class="line">chmod -vR 700 /homemysqldata/</span><br></pre></td></tr></tbody></table></figure><h2 id="修改数据库配置"><a href="#修改数据库配置" class="headerlink" title="修改数据库配置"></a>修改数据库配置</h2><figure class="highlight plain"><figcaption><span>/etc/my.conf</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/my.conf</span><br><span class="line"></span><br><span class="line"># 修改为</span><br><span class="line">datadir=/home/mysqldata</span><br><span class="line">socket=/home/mysqldata/mysql.sock</span><br></pre></td></tr></tbody></table></figure><h2 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 有时会出现文件权限问题 errorcode：13</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mysql默认安装目录</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls -ldZ /var/lib/mysql</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结果</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> drwxr-x---. mysql mysql system_u:object_r:mysqld_db_t:s0 /var/lib/mysql</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看调整后的目录权限</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls -ldZ /home/mysqldata/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结果</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> drwxr-x---. mysql mysql unconfined_u:object_r:unlabeled_t:s0 /home/mysqldata/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改</span></span><br><span class="line">chcon -Rv -u system_u -t mysqld_db_t /home/mysqldata/</span><br></pre></td></tr></tbody></table></figure><blockquote><p>如果上面修改权限后还是因为权限问题无法启动,下面二种方式(推荐第二种)执行后再</p></blockquote><blockquote><p>1.可以先关闭selinux<br><code>vim /etc/selinux/config</code>,将<br><code>SELINUX=permissive</code> -> <code>SELINUX=disabled</code>，需要重启机器<br>2.也可以使用<code>setenforce 0</code>临时关闭后再执行修改目录权限命令</p></blockquote><hr><!-- rebuild by neat --></body></html>]]></content>
      
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一些特殊用法</title>
      <link href="/post/4e463d48.html"/>
      <url>/post/4e463d48.html</url>
      
        <content type="html"><![CDATA[<!-- build time:Wed Jan 30 2019 19:14:34 GMT+0800 (GMT+08:00) --><html><head></head><body><h2 id="代码块带目录"><a href="#代码块带目录" class="headerlink" title="代码块带目录"></a>代码块带目录</h2><figure class="highlight java"><figcaption><span>custom.java</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><a id="more"></a><h2 id="tag"><a href="#tag" class="headerlink" title="tag"></a>tag</h2><blockquote><ul><li>danger</li><li>default</li><li>primary</li><li>info</li><li>success</li><li>warning</li><li>danger</li><li>[option] [no-icon]</li></ul></blockquote><div class="note danger"><meta name="generator" content="Hexo 3.8.0"><p>note text<br>note text<br>note text</p></div><div class="note default"><meta name="generator" content="Hexo 3.8.0"><p>note text<br>note text<br>note text</p></div><h2 id="tabs"><a href="#tabs" class="headerlink" title="tabs"></a>tabs</h2><div class="tabs" id="first-unique-name"><ul class="nav-tabs"><li class="tab active"><a href="#first-unique-name-1">First unique name 1</a></li><li class="tab"><a href="#first-unique-name-2">First unique name 2</a></li><li class="tab"><a href="#first-unique-name-3">First unique name 3</a></li></ul><div class="tab-content"><div class="tab-pane active" id="first-unique-name-1"><meta name="generator" content="Hexo 3.8.0"><p><strong>This is Tab 1.</strong></p></div><div class="tab-pane" id="first-unique-name-2"><meta name="generator" content="Hexo 3.8.0"><p><strong>This is Tab 2.</strong></p></div><div class="tab-pane" id="first-unique-name-3"><meta name="generator" content="Hexo 3.8.0"><p><strong>This is Tab 3.</strong></p></div></div></div><hr><!-- rebuild by neat --></body></html>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>mysql gtid读写分离主从同步生产环境实战</title>
      <link href="/post/a95699cc.html"/>
      <url>/post/a95699cc.html</url>
      
        <content type="html"><![CDATA[<!-- build time:Wed Jan 30 2019 19:14:34 GMT+0800 (GMT+08:00) --><html><head></head><body><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul><li>mysql-5.7.19</li><li>Centos7</li><li>master: 192.168.111.64</li><li>slave: 192.168.111.66</li></ul><h2 id="主从配置"><a href="#主从配置" class="headerlink" title="主从配置"></a>主从配置</h2><h3 id="master配置"><a href="#master配置" class="headerlink" title="master配置"></a>master配置</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">## GTID</span><br><span class="line">server_id = 100  # 服务器id，从库最好大于主库,注意要唯一</span><br><span class="line">gtid_mode = on    #开启gtid模式</span><br><span class="line">enforce_gtid_consistency = on    #强制gtid一致性，开启后对特定的create table不被支持</span><br><span class="line">log-bin = mysql-bin    #开启二进制日志</span><br><span class="line">binlog_format = row    #默认为mixed混合模式，更改成row复制，为了数据一致性</span><br><span class="line">log-slave-updates = 1    #从库binlog才会记录主库同步的操作日志</span><br><span class="line">skip_slave_start=1    #跳过slave复制线程</span><br></pre></td></tr></tbody></table></figure><a id="more"></a><h3 id="slave配置"><a href="#slave配置" class="headerlink" title="slave配置"></a>slave配置</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">## 设置server_id，注意要唯一</span><br><span class="line">server_id=101</span><br><span class="line">log-bin = mysql-bin</span><br><span class="line">binlog_format = row</span><br><span class="line">log-slave-updates = 1</span><br><span class="line">gtid_mode = on</span><br><span class="line">enforce_gtid_consistency = on</span><br><span class="line">skip_slave_start=1</span><br><span class="line"># 从库设置为只读</span><br><span class="line">read_only=on</span><br></pre></td></tr></tbody></table></figure><h2 id="重启数据库"><a href="#重启数据库" class="headerlink" title="重启数据库"></a>重启数据库</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld restart</span><br></pre></td></tr></tbody></table></figure><h2 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h2><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用户从库同步</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>,RELOAD,<span class="keyword">SHOW</span> <span class="keyword">DATABASES</span>,<span class="keyword">LOCK</span> <span class="keyword">TABLES</span>,<span class="keyword">EVENT</span>,<span class="keyword">REPLICATION</span> <span class="keyword">CLIENT</span>  <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">'repl_user'</span>@<span class="string">'192.168.111.64'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建只读用户，用户从库读取数据</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">Select</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">'reader'</span>@<span class="string">'192.168.111.%'</span>  <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">"123456"</span>;</span><br></pre></td></tr></tbody></table></figure><h2 id="数据导出"><a href="#数据导出" class="headerlink" title="数据导出"></a>数据导出</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在192.169.111.66上操作</span></span><br><span class="line">nohup mysqldump --single-transaction --master-data=2 --triggers --routines --all-databases --events -h192.168.111.64 -u'root' -p'password' > /home/backup.sql &</span><br></pre></td></tr></tbody></table></figure><blockquote><p>因为数据量较大(导出大概30G)，使用<code>nohup [commend] &</code> 使用后台导出，防止导出时间过长连接断开，可以使用<code>jobs -l</code>命令查看</p></blockquote><blockquote><p>数据导出也可以直接在主库服务器上导出，然后通过<code>scp backup.sql 192.168.111.66:/home</code>命令传到从库服务器</p></blockquote><h2 id="从库数据导入"><a href="#从库数据导入" class="headerlink" title="从库数据导入"></a>从库数据导入</h2><h3 id="连接mysql导入"><a href="#连接mysql导入" class="headerlink" title="连接mysql导入"></a>连接mysql导入</h3><ul><li>登陆mysql</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 连接到数据库</span></span><br><span class="line">mysql -uroot -p'123456';</span><br></pre></td></tr></tbody></table></figure><ul><li>执行导入sql命令</li></ul><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /home/backup.sql</span><br></pre></td></tr></tbody></table></figure><h3 id="命令直接导入"><a href="#命令直接导入" class="headerlink" title="命令直接导入"></a>命令直接导入</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup mysql -uroot -p’123456’ < /home/backup.sql &</span><br></pre></td></tr></tbody></table></figure><blockquote><p>推荐第二种方式，尤其是数据量较大的情况下</p></blockquote><h2 id="在192-168-111-66上设置主从连接"><a href="#在192-168-111-66上设置主从连接" class="headerlink" title="在192.168.111.66上设置主从连接"></a>在192.168.111.66上设置主从连接</h2><ul><li>连接mysql</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p'123456'</span><br></pre></td></tr></tbody></table></figure><ul><li>设置</li></ul><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置</span></span><br><span class="line"><span class="keyword">CHANGE</span> <span class="keyword">MASTER</span> <span class="keyword">TO</span> MASTER_HOST=<span class="string">'192.168.111.64'</span>, MASTER_PORT=<span class="number">3306</span>,MASTER_USER=<span class="string">'repl_user'</span>,MASTER_PASSWORD=<span class="string">'123456'</span>,MASTER_AUTO_POSITION=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启主从</span></span><br><span class="line"><span class="keyword">start</span> <span class="keyword">slave</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看主从状态</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">slave</span> <span class="keyword">status</span> \G;</span><br></pre></td></tr></tbody></table></figure><blockquote><p>常用命令:</p><ul><li>停止同步:<code>stop slave</code></li><li>重置从库状态:<code>reset slave</code></li><li>重置主库状态:<code>reset master</code></li></ul></blockquote><hr><!-- rebuild by neat --></body></html>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> gtid </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginx添加新模块以及自定义http响应头</title>
      <link href="/post/15b18a2.html"/>
      <url>/post/15b18a2.html</url>
      
        <content type="html"><![CDATA[<!-- build time:Wed Jan 30 2019 19:14:35 GMT+0800 (GMT+08:00) --><html><head></head><body><h2 id="需求场景"><a href="#需求场景" class="headerlink" title="需求场景"></a>需求场景</h2><p>编译好的nginx需要添加headers-more-nginx-module模块来自定义响应头</p><blockquote><p>nginx其它模块同样适用</p></blockquote><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul><li>nginx包目录:/app/nginx-1.12.2</li><li>nginx安装目录:/app/nginx112</li><li>插件目录:/app/tools/headers-more-nginx-module-0.33</li><li>系统环境centOs7</li></ul><a id="more"></a><h2 id="资源地址"><a href="#资源地址" class="headerlink" title="资源地址"></a>资源地址</h2><ul><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL29wZW5yZXN0eS9oZWFkZXJzLW1vcmUtbmdpbngtbW9kdWxl" title="https://github.com/openresty/headers-more-nginx-module"><i class="fa fa-link"></i>headers-more-nginx-module-0.33github地址<i class="fa fa-external-link"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL29wZW5yZXN0eS9oZWFkZXJzLW1vcmUtbmdpbngtbW9kdWxlI2NvbXBhdGliaWxpdHk=" title="https://github.com/openresty/headers-more-nginx-module#compatibility"><i class="fa fa-link"></i>查看插件支持的nginx版本github地址<i class="fa fa-external-link"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL29wZW5yZXN0eS9oZWFkZXJzLW1vcmUtbmdpbngtbW9kdWxlL3RhZ3M=" title="https://github.com/openresty/headers-more-nginx-module/tags"><i class="fa fa-link"></i>headers-more-nginx-module下载地址<i class="fa fa-external-link"></i></span></li><li><span class="exturl" data-url="aHR0cDovL25naW54Lm9yZy8=" title="http://nginx.org/"><i class="fa fa-link"></i>nginx下载地址<i class="fa fa-external-link"></i></span></li></ul><h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 举例目录/app/tools</span></span><br><span class="line">cd /app/tools/</span><br><span class="line"><span class="meta">#</span><span class="bash">下载插件</span></span><br><span class="line">wget https://github.com/openresty/headers-more-nginx-module/archive/v0.33.tar.gz</span><br><span class="line"><span class="meta">#</span><span class="bash">解压</span></span><br><span class="line">tar -zxvf v0.33.tar.gz</span><br></pre></td></tr></tbody></table></figure><h2 id="加载模块"><a href="#加载模块" class="headerlink" title="加载模块"></a>加载模块</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看安装参数命令(取出：configure arguments:)</span></span><br><span class="line">/app/nginx/sbin/nginx -V</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在nginx资源目录编译</span></span><br><span class="line">cd /app/nginx-1.12.2/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将上面取出的configure arguments后面追加 --add-module=/app/tools/headers-more-nginx-module-0.33</span></span><br><span class="line">./configure --prefix=/app/nginx112 --add-module=/app/tools/headers-more-nginx-module-0.33</span><br><span class="line"><span class="meta">#</span><span class="bash"> 编辑，切记没有make install</span></span><br><span class="line">make</span><br><span class="line"><span class="meta">#</span><span class="bash"> 备份</span></span><br><span class="line">cp /app/nginx112/sbin/nginx /app/nginx112/sbin/nginx.bak </span><br><span class="line"><span class="meta">#</span><span class="bash"> 覆盖(覆盖提示输入y)</span></span><br><span class="line">cp -f /app/nginx-1.12.2/objs/nginx /app/nginx112/sbin/nginx</span><br></pre></td></tr></tbody></table></figure><h2 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /app/nginx112/conf/nginx.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加配置(在http模块)</span></span><br><span class="line">more_clear_headers 'Server';</span><br></pre></td></tr></tbody></table></figure><blockquote><p>上面配置只是将http响应头中的Server:nginx/1.12.2清楚，详细使用方案可阅读<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL29wZW5yZXN0eS9oZWFkZXJzLW1vcmUtbmdpbngtbW9kdWxl" title="https://github.com/openresty/headers-more-nginx-module">参考文档<i class="fa fa-external-link"></i></span>,<br>支持添加·修改·清除响应头的操作，</p></blockquote><h2 id="重启nginx"><a href="#重启nginx" class="headerlink" title="重启nginx"></a>重启nginx</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/app/nginx112/sbin/nginx -s stop</span><br><span class="line">/app/nginx112/sbin/nginx</span><br></pre></td></tr></tbody></table></figure><blockquote><p>直接使用reload可能会无效</p></blockquote><hr><!-- rebuild by neat --></body></html>]]></content>
      
      
      <categories>
          
          <category> nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql三种安装方式之-rpm方式安装</title>
      <link href="/post/dceaf414.html"/>
      <url>/post/dceaf414.html</url>
      
        <content type="html"><![CDATA[<!-- build time:Wed Jan 30 2019 19:14:34 GMT+0800 (GMT+08:00) --><html><head></head><body><h3 id="查看安装以及卸载"><a href="#查看安装以及卸载" class="headerlink" title="查看安装以及卸载"></a>查看安装以及卸载</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看</span></span><br><span class="line">rpm -qa | grep mysql</span><br><span class="line"><span class="meta">#</span><span class="bash"> 卸载</span></span><br><span class="line">yum -y remove mysql-libs-5.1.66-2.el6_3.x86_64</span><br></pre></td></tr></tbody></table></figure><h3 id="安装包资源地址"><a href="#安装包资源地址" class="headerlink" title="安装包资源地址"></a>安装包资源地址</h3><p><span class="exturl" data-url="aHR0cHM6Ly9kZXYubXlzcWwuY29tL2Rvd25sb2Fkcy9teXNxbC8=" title="https://dev.mysql.com/downloads/mysql/"><i class="fa fa-download"></i>mysql下载地址<i class="fa fa-external-link"></i></span></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载资源名称</span></span><br><span class="line">mysql-5.7.22-1.el7.x86_64.rpm-bundle.tar</span><br></pre></td></tr></tbody></table></figure><a id="more"></a><h3 id="解压资源"><a href="#解压资源" class="headerlink" title="解压资源"></a>解压资源</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf mysql-5.7.22-1.el7.x86_64.rpm-bundle.tar</span><br></pre></td></tr></tbody></table></figure><h3 id="获取rpm包"><a href="#获取rpm包" class="headerlink" title="获取rpm包"></a>获取rpm包</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql-community-common-5.7.19-1.el6.x86_64.rpm</span><br><span class="line">mysql-community-client-5.7.19-1.el6.x86_64.rpm</span><br><span class="line">mysql-community-server-5.7.19-1.el6.x86_64.rpm</span><br><span class="line">mysql-community-libs-5.7.19-1.el6.x86_64.rpm</span><br></pre></td></tr></tbody></table></figure><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 安装顺序</span><br><span class="line"># common --> libs --> clients --> server</span><br><span class="line"># 安装命令</span><br><span class="line">rpm -ivh mysql-community-common-5.7.19-1.el6.x86_64.rpm mysql-community-libs-5.7.19-1.el6.x86_64.rpm mysql-community-client-5.7.19-1.el6.x86_64.rpm mysql-community-server-5.7.19-1.el6.x86_64.rpm</span><br></pre></td></tr></tbody></table></figure><blockquote><p>1.centos7需要先卸载mariadb，卸载命令<code>rpm -qa | grep mariadb</code></p></blockquote><blockquote><p>可能需要依赖包<code>libaio</code><br>安装命令<code>yum -y install libaio</code></p></blockquote><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld --initialize --user=mysql</span><br></pre></td></tr></tbody></table></figure><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld start</span><br></pre></td></tr></tbody></table></figure><h3 id="登陆"><a href="#登陆" class="headerlink" title="登陆"></a>登陆</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查看初始密码</span><br><span class="line">cat /var/logs/mysql.log</span><br><span class="line"># 登陆</span><br><span class="line">mysql -uroot -p'123456'</span><br><span class="line"># 修改初始密码</span><br><span class="line">set PASSWORD=PASSWORD('密码');</span><br></pre></td></tr></tbody></table></figure><h3 id="授权远程链接"><a href="#授权远程链接" class="headerlink" title="授权远程链接"></a>授权远程链接</h3><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 授权192.168.0.1可以远程链接*[所有数据库].*[所有表] 账号：root 密码123456</span></span><br><span class="line"><span class="keyword">grant</span> all <span class="keyword">privileges</span> <span class="keyword">on</span> *.* <span class="keyword">to</span> <span class="string">'root'</span>@<span class="string">'192.168.0.1'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'123456'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">### 授权所有ip</span></span><br><span class="line"><span class="keyword">grant</span> all <span class="keyword">privileges</span> <span class="keyword">on</span> *.* <span class="keyword">to</span> <span class="string">'root'</span>@<span class="string">'%'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'123456'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">### 以上*.*表示[数据库].[表]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 使授权立刻生效</span></span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></tbody></table></figure><!-- rebuild by neat --></body></html>]]></content>
      
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> linux </tag>
            
            <tag> centos </tag>
            
            <tag> rpm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>github pages和hexo博客搭建</title>
      <link href="/post/869e96f6.html"/>
      <url>/post/869e96f6.html</url>
      
        <content type="html"><![CDATA[<!-- build time:Wed Jan 30 2019 19:14:34 GMT+0800 (GMT+08:00) --><html><head></head><body><h3 id="前期准备工作"><a href="#前期准备工作" class="headerlink" title="前期准备工作"></a>前期准备工作</h3><ul><li>安装<span class="exturl" data-url="aHR0cHM6Ly9naXQtc2NtLmNvbS9kb3dubG9hZHM=" title="https://git-scm.com/downloads">git<i class="fa fa-external-link"></i></span></li><li>安装<span class="exturl" data-url="aHR0cDovL25vZGVqcy5jbi8=" title="http://nodejs.cn/">node<i class="fa fa-external-link"></i></span></li></ul><h3 id="本地初始化hexo"><a href="#本地初始化hexo" class="headerlink" title="本地初始化hexo"></a>本地初始化hexo</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局安装hexo脚手架</span></span><br><span class="line">npm install hexo-cli -g</span><br><span class="line"><span class="comment"># 当前目录创建myblog,并在myblog下初始化hexo</span></span><br><span class="line">hexo init myblog</span><br><span class="line"><span class="built_in">cd</span> myblog</span><br><span class="line"><span class="comment"># 安装依赖</span></span><br><span class="line">npm install</span><br></pre></td></tr></tbody></table></figure><a id="more"></a><h3 id="hexo常用命令"><a href="#hexo常用命令" class="headerlink" title="hexo常用命令"></a>hexo常用命令</h3><table><thead><tr><th>命令</th><th>作用</th></tr></thead><tbody><tr><td>hexo g</td><td>编译(hexo generate)</td></tr><tr><td>hexo s</td><td>启动hexo本地服务(hexo server)</td></tr><tr><td>hexo d</td><td>上传(hexo deploy),前提是配置好git弟子</td></tr><tr><td>hexo n ‘page’</td><td>新建页面(hexo new ‘’或者hexo new page ‘’)</td></tr></tbody></table><h3 id="github项目准备"><a href="#github项目准备" class="headerlink" title="github项目准备"></a>github项目准备</h3><ul><li><p>新建项目,项目名称<code>[github name].github.io</code></p><blockquote><p>没有github的先去注册<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29t" title="https://github.com">github<i class="fa fa-external-link"></i></span>账号</p></blockquote></li><li><p>创建完成后，复制该项目的git地址</p><blockquote><p><span class="exturl" data-url="bWFpbHRvOmdpdEBnaXRodWIuY29t" title="mailto:git@github.com">git@github.com<i class="fa fa-external-link"></i></span>:it-daily/it-daily.github.io.git</p></blockquote></li><li><p>将git地址复制到hexo的_config.yml</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  <span class="built_in">type</span>: git</span><br><span class="line">  repo: git@github.com:it-daily/it-daily.github.io.git</span><br><span class="line">  branch: master</span><br></pre></td></tr></tbody></table></figure></li><li><p>生成SSH key</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查当前用户.ssh下是否存在id_rsa和id_rsa.pub这两个文件,不存在生成</span></span><br><span class="line">ssh-keygen -t rsa -C <span class="string">"youremail@example.com"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一路回车，在用户主目录里找到.ssh目录，里面有 id_rsa 和 id_rsa.pub 两个文件，这两个就是 SSH Key 的秘钥对，id_rsa是私钥，不能泄露出去，id_rsa.pub是公钥</span></span><br></pre></td></tr></tbody></table></figure></li><li><p>登陆 GitHub设置ssh key</p><blockquote><p>打开“Account settings”，“SSH Keys”页面，点“Add SSH Key”，填上任意 Title，在 Key 文本框里粘贴id_rsa.pub文件的内容</p></blockquote></li><li><p>生成博客的静态文件</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></tbody></table></figure></li><li><p>安装hexo git插件</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></tbody></table></figure></li><li><p>上传静态文件到GitHub</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo d</span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id="博客maupassant主题"><a href="#博客maupassant主题" class="headerlink" title="博客maupassant主题"></a>博客maupassant主题</h3><p>请参照<span class="exturl" data-url="aHR0cHM6Ly93d3cuaGFvbXdlaS5jb20vdGVjaG5vbG9neS9tYXVwYXNzYW50LWhleG8uaHRtbA==" title="https://www.haomwei.com/technology/maupassant-hexo.html">maupassant<i class="fa fa-external-link"></i></span></p><!-- rebuild by neat --></body></html>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
            <tag> hexo </tag>
            
            <tag> github </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
